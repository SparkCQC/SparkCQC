SELECT T1.CA_ID, T1.S_SYMB, MAX(T2.T_TRADE_PRICE-T1.T_TRADE_PRICE)
FROM trade T1, trade T2
WHERE T1.T_TT_ID LIKE '%B%' AND T2.T_TT_ID LIKE '%S%'
  AND T1.CA_ID = T2.CA_ID AND T1.T_S_SYBM = T2.T_S_SYMB
  AND T1.T_DTS <= T2.T_DTS AND T1.T_DTS + interval '90' day >= T2.T_DTS
GROUP BY T1.CA_ID, T1.T_S_SYBM